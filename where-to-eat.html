<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Where Should We Eat - Sam Freund</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="stylesheet" type="text/css" href="css/style.css">
	<link rel="stylesheet" type="text/css" href="css/where-to-eat.css">
	<link rel="icon" type="image/x-icon" href="/images/icons/smalllogo.ico">
</head>
<body>
	<nav id="navigation" class="navbar navbar-expand-lg">
		<a class="navbar-brand" href="index.html">SF</a>
		<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
			aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		</button>
		<div class="collapse navbar-collapse" id="navbarNav">
			<ul class="navbar-nav">
				<li class="nav-item">
					<a class="nav-link" href="index.html">About</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="experience.html">Experience</a>
				</li>
				<li class="nav-item active">
					<a class="nav-link" href="portfolio.html">Portfolio <span class="visually-hidden">(current)</span></a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="blog.html">Blog</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="index.html#contact">Contact</a>
				</li>
			</ul>
		</div>
	</nav>

	<main class="eat-page section">
		<div class="container eat-wrap">
			<div class="eat-header">
				<h1>WHERE SHOULD WE EAT?</h1>
				<p>Add places and people, then each person ranks the places. Final ranking is scored automatically.</p>
			</div>

			<div class="eat-grid">
				<section class="eat-card">
					<h2>1. Places</h2>
					<form id="place-form" class="eat-inline-form">
						<input id="place-input" type="text" placeholder="Add a restaurant or food spot" required>
						<button class="eat-btn eat-btn-primary" type="submit">Add</button>
					</form>
					<ul id="place-list" class="eat-chip-list"></ul>
				</section>

				<section class="eat-card">
					<h2>2. People</h2>
					<form id="person-form" class="eat-inline-form">
						<input id="person-input" type="text" placeholder="Add a person voting" required>
						<button class="eat-btn eat-btn-primary" type="submit">Add</button>
					</form>
					<ul id="person-list" class="eat-chip-list"></ul>
				</section>
			</div>

			<section class="eat-card">
				<div class="eat-row">
					<h2>3. Individual Rankings</h2>
					<button id="build-rankings" class="eat-btn eat-btn-secondary" type="button">Build/Refresh Ranking Boards</button>
				</div>
				<p class="eat-help">Use arrows to reorder from top choice to last choice for each person.</p>
				<div id="ranking-boards" class="eat-boards"></div>
			</section>

			<section class="eat-card">
				<div class="eat-row">
					<h2>4. Results</h2>
					<button id="score-btn" class="eat-btn eat-btn-primary" type="button">Calculate Final Score</button>
				</div>
				<p class="eat-help">Scoring uses Borda count: top pick gets most points, last pick gets 1.</p>
				<div id="results" class="eat-results"></div>
			</section>
		</div>
	</main>

	<footer class="copyrightSection">
		<p>&copy; Sam Freund 2025</p>
	</footer>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
	<script>
		(function() {
			var places = [];
			var people = [];
			var rankings = {};

			var placeForm = document.getElementById('place-form');
			var placeInput = document.getElementById('place-input');
			var placeList = document.getElementById('place-list');

			var personForm = document.getElementById('person-form');
			var personInput = document.getElementById('person-input');
			var personList = document.getElementById('person-list');

			var boardsEl = document.getElementById('ranking-boards');
			var resultsEl = document.getElementById('results');

			function norm(value) {
				return value.trim().replace(/\s+/g, ' ');
			}

			function addUnique(list, value) {
				if (list.indexOf(value) === -1) list.push(value);
			}

			function removeAt(list, idx) {
				list.splice(idx, 1);
			}

			function renderChips(target, list, onRemove) {
				if (!list.length) {
					target.innerHTML = '<li class="eat-empty">None yet</li>';
					return;
				}
				target.innerHTML = list.map(function(item, idx) {
					return '<li class="eat-chip">'
						+ '<span>' + item + '</span>'
						+ '<button type="button" data-idx="' + idx + '" aria-label="Remove ' + item + '"><i class="fas fa-xmark"></i></button>'
						+ '</li>';
				}).join('');
				target.querySelectorAll('button[data-idx]').forEach(function(btn) {
					btn.addEventListener('click', function() {
						onRemove(parseInt(btn.getAttribute('data-idx'), 10));
					});
				});
			}

			function renderPlaceChips() {
				renderChips(placeList, places, function(idx) {
					removeAt(places, idx);
					renderPlaceChips();
					renderBoards();
					scoreResults();
				});
			}

			function renderPersonChips() {
				renderChips(personList, people, function(idx) {
					removeAt(people, idx);
					renderPersonChips();
					renderBoards();
					scoreResults();
				});
			}

			function ensureRankings() {
				people.forEach(function(person) {
					if (!rankings[person]) {
						rankings[person] = places.slice();
					} else {
						var ordered = rankings[person].filter(function(p) { return places.indexOf(p) !== -1; });
						places.forEach(function(p) {
							if (ordered.indexOf(p) === -1) ordered.push(p);
						});
						rankings[person] = ordered;
					}
				});

				Object.keys(rankings).forEach(function(person) {
					if (people.indexOf(person) === -1) delete rankings[person];
				});
			}

			function move(arr, from, to) {
				if (to < 0 || to >= arr.length) return;
				var item = arr[from];
				arr.splice(from, 1);
				arr.splice(to, 0, item);
			}

			function renderBoards() {
				ensureRankings();
				if (!people.length || !places.length) {
					boardsEl.innerHTML = '<p class="eat-empty">Add at least 1 place and 1 person first.</p>';
					return;
				}

				var html = '';
				people.forEach(function(person) {
					html += '<div class="eat-board" data-person="' + person + '">';
					html += '<h3>' + person + '</h3>';
					html += '<ol>';
					rankings[person].forEach(function(place, idx) {
						html += '<li>';
						html += '<span class="eat-place-name">' + place + '</span>';
						html += '<div class="eat-order-actions">';
						html += '<button type="button" data-person="' + person + '" data-index="' + idx + '" data-dir="-1" aria-label="Move up"><i class="fas fa-arrow-up"></i></button>';
						html += '<button type="button" data-person="' + person + '" data-index="' + idx + '" data-dir="1" aria-label="Move down"><i class="fas fa-arrow-down"></i></button>';
						html += '</div>';
						html += '</li>';
					});
					html += '</ol>';
					html += '</div>';
				});
				boardsEl.innerHTML = html;

				boardsEl.querySelectorAll('button[data-person]').forEach(function(btn) {
					btn.addEventListener('click', function() {
						var person = btn.getAttribute('data-person');
						var idx = parseInt(btn.getAttribute('data-index'), 10);
						var dir = parseInt(btn.getAttribute('data-dir'), 10);
						move(rankings[person], idx, idx + dir);
						renderBoards();
					});
				});
			}

			function scoreResults() {
				ensureRankings();
				if (!people.length || !places.length) {
					resultsEl.innerHTML = '<p class="eat-empty">Nothing to score yet.</p>';
					return;
				}

				var scores = {};
				places.forEach(function(p) { scores[p] = 0; });

				people.forEach(function(person) {
					var rank = rankings[person] || [];
					var max = rank.length;
					rank.forEach(function(place, idx) {
						scores[place] += (max - idx);
					});
				});

				var rows = Object.keys(scores).map(function(place) {
					return { place: place, score: scores[place] };
				});
				rows.sort(function(a, b) {
					if (b.score !== a.score) return b.score - a.score;
					return a.place.localeCompare(b.place);
				});

				var html = '<table class="table eat-table"><thead><tr><th>Rank</th><th>Place</th><th>Score</th></tr></thead><tbody>';
				rows.forEach(function(row, idx) {
					html += '<tr><td>' + (idx + 1) + '</td><td>' + row.place + '</td><td>' + row.score + '</td></tr>';
				});
				html += '</tbody></table>';
				resultsEl.innerHTML = html;
			}

			placeForm.addEventListener('submit', function(e) {
				e.preventDefault();
				var value = norm(placeInput.value);
				if (!value) return;
				addUnique(places, value);
				placeInput.value = '';
				renderPlaceChips();
				renderBoards();
				scoreResults();
			});

			personForm.addEventListener('submit', function(e) {
				e.preventDefault();
				var value = norm(personInput.value);
				if (!value) return;
				addUnique(people, value);
				personInput.value = '';
				renderPersonChips();
				renderBoards();
				scoreResults();
			});

			document.getElementById('build-rankings').addEventListener('click', function() {
				renderBoards();
			});

			document.getElementById('score-btn').addEventListener('click', function() {
				scoreResults();
			});

			renderPlaceChips();
			renderPersonChips();
			renderBoards();
			scoreResults();
		})();
	</script>
</body>
</html>
